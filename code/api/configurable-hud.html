<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configurable HUD - Wanderers of the Rift Internal Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Wanderers of the Rift Internal Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Dimension-Delvers/dimension-delvers-docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/Dimension-Delvers/dimension-delvers-docs/edit/main/src/code/api/configurable-hud.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="configurable-hud"><a class="header" href="#configurable-hud">Configurable HUD</a></h1>
<p>Wanderers of the Rift has a system for defining HUD elements whose rendering location can be configured, including the possibility of rotating for
compatible elements.</p>
<h2 id="principals"><a class="header" href="#principals">Principals</a></h2>
<p>A HUD element is rendered relative to a <code>ScreenAnchor</code>. There are nine of these - one for each corner of the screen, one for the center of each
side of the screen, and one for the center of the screen. Being anchored means that regardless of the screen size the element should moved to maintain the
same offset from that anchor. For example, when you resize the screen the hotbar remains attached to the bottom-center of the screen.</p>
<p>To achieve this the size of the HUD element needs to be known - its width and height. This allows the correct top-left position to be determined.</p>
<p>For HUD elements that can grow or change sizes, this growth should ideally be "away" from the anchor. For example, when the player gains
additional hearts, they should appear in a new row above if anchored to the bottom of the screen, and a new row below if anchored to
the top of the screen.</p>
<h2 id="configuration-info"><a class="header" href="#configuration-info">Configuration Info</a></h2>
<p>Each HUD element has the following configuration:</p>
<ul>
<li>Whether the element is visible</li>
<li>Where the element is anchored</li>
<li>The x,y offset of the HUD element in pixels. This is applied relative to where the element is anchored.</li>
<li>Optionally, the orientation of the element if rotation is supported.</li>
</ul>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<h3 id="adapting-an-existing-hud-element"><a class="header" href="#adapting-an-existing-hud-element">Adapting an existing HUD element</a></h3>
<p>For use with vanilla or HUD elements from other mods.</p>
<p>In ClientConfig, add a <code>HudElementConfig</code> for the HUD element - this will capture the player's configuration. Ensure the default values reflect
how the element is placed normally:</p>
<pre><code class="language-java">public static final HudElementConfig EXPERIENCE_BAR;

static {
    // For example, minecraft experience bar is displayed relative to the bottom-center of the screen
    EXPERIENCE_BAR = new HudElementConfig.Builder("Vanilla Experience Bar", "xpBar")
            .anchor(ScreenAnchor.BOTTOM_CENTER)
            .offset(0, -24)
            // If not specified, the element cannot be rotated
            .rotates(UIOrientation.HORIZONTAL)
            .build(builder);
}
</code></pre>
<p>Next register a ConfigurableLayerAdapter for the element - this will intercept the rendering of element and reposition (and optionally rotate) it based
on the configuration. A basic fixed size adapter is provided to handle basic HUD elements - this requires knowing the maximum width and height of the element.
A separate DeferredRegister should be used for vanilla and each mod.</p>
<pre><code class="language-java">public static final DeferredRegister&lt;ConfigurableLayer&gt; VANILLA_LAYERS = DeferredRegister
        .create(WotrClientRegistries.Keys.CONFIGURABLE_LAYERS, "minecraft");

public static final Supplier&lt;ConfigurableLayerAdapter&gt; VANILLA_XP_BAR = VANILLA_LAYERS.register(
            VanillaGuiLayers.EXPERIENCE_BAR.getPath(),
            () -&gt; new FixedSizeLayerAdapter(Component.translatable("hud.minecraft.experience_bar"), ClientConfig.EXPERIENCE_BAR, 182, 5, List.of(VanillaGuiLayers.EXPERIENCE_BAR)));
</code></pre>
<p>For more advanced handling a custom adapter can be created by implementing <code>ConfigurableLayerAdapter</code>. This provides access to <code>preRender</code>, <code>render</code>, and <code>postRender</code> for the layer.
This can be used to manipulate the poseStack to reposition and rotate the existing layer when it is rendered. Do take care to undo any transformations made in <code>preRender</code>.</p>
<h3 id="creating-a-native-configurable-hud-element"><a class="header" href="#creating-a-native-configurable-hud-element">Creating a native configurable HUD element</a></h3>
<p>First, once more will need to add a <code>HudElementConfig</code> for the new HUD element:</p>
<pre><code class="language-java">public static final HudElementConfig MANA_BAR;

static {
MANA_BAR = new HudElementConfig.Builder("Mana Bar", "manaBar").anchor(ScreenAnchor.TOP_LEFT)
                .offset(25, 0)
                // Optional, if rotates is not specified then the HUD element will not be rotatable
                .rotates(UIOrientation.VERTICAL)
                .build(builder);
}
</code></pre>
<p>The HUD element itself should implement <code>ConfigurableLayer</code> - this requires implementing four methods. These are used primarily
by the configuration UI.</p>
<pre><code class="language-java">public class ManaBar implements ConfigurableLayer {
    /**
     * @return The name of the Layer (for display in tooltip)
     */
    public Component getName() {
        return Component.translatable("hud.mymod.manabar");
    }

    /**
     * @return The configuration that controls the layer's positioning
     */
    public HudElementConfig getConfig() {
        return ClientConfig.MANA_BAR;
    }

    /**
     * @return The width to display the element in the configuration screen. Ideally this is the display width of the
     *         element, but may be representative of its potential width instead. Should not be zero. Should account
     *         for rotation though.
     */
    public int getConfigWidth() {
        return getConfig().getOrientation() == UIOrientation.VERTICAL ? 10 : 100;
    }

    /**
     * @return The height to display the element in the configuration screen. Ideally this is the display height of the
     *         element, but may be representative of its potential width instead. Should not be zero. Should account
     *         for rotation though.
     */
    public int getConfigHeight() {
        return getConfig().getOrientation() == UIOrientation.VERTICAL ? 100 : 10;
    }
}
</code></pre>
<p>Beyond this, when rendering the element should use the config to determine where it should render:</p>
<pre><code class="language-java">@Override
public void render(@NotNull GuiGraphics guiGraphics, @NotNull DeltaTracker deltaTracker) {
    // General check for whether to render the element, including a getConfig().isVisible check.
    Minecraft minecraft = Minecraft.getInstance();
    if (minecraft.options.hideGui || !getConfig().isVisible() || minecraft.gameMode == null
            || minecraft.gameMode.getPlayerMode() == GameType.SPECTATOR) {
        return;
    }
    
    // Determine the width and height of the element. This may need information about the player or state of the game
    int width = calcWidth();
    int height = calcHeight();
    
    // Top-left screen pos to render the element in
    Vector2i pos = getConfig().getPosition(width, height, guiGraphics.guiWidth(), guiGraphics.guiHeight());
    // Other config settings such as orientation can be used to determine how to render too.
    UIOrientation orientation = getConfig().getOrientation();
}
</code></pre>
<p>The HUD element should be registered as a configurable layer:</p>
<pre><code class="language-java">public class ModConfigurableLayers {
    public static final DeferredRegister&lt;ConfigurableLayer&gt; LAYERS = DeferredRegister
            .create(WotrClientRegistries.Keys.CONFIGURABLE_LAYERS, Mod.MODID);

    public static final Supplier&lt;ConfigurableLayer&gt; MANA_BAR = LAYERS.register("mana_bar", ManaBar::new);
}
</code></pre>
<p>and should also be registered as a GuiLayer:</p>
<pre><code class="language-java">@EventBusSubscriber(modid = Mod.MODID, bus = EventBusSubscriber.Bus.MOD, value = Dist.CLIENT)
public class ModGuiLayers {
    public static final ResourceLocation MANA_BAR = ResourceLocation.fromNamespaceAndPath(Mod.MODID, "mana_bar");
    
    @SubscribeEvent
    public static void registerGuiLayers(RegisterGuiLayersEvent event) {
        event.registerAbove(VanillaGuiLayers.HOTBAR, MANA_BAR, ModConfigurableLayers.MANA_BAR.get());
    }
}

</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../code/api/quickmover.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../code/decisions/decisions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../code/api/quickmover.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../code/decisions/decisions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
